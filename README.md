# üçΩÔ∏è Sistema de Comandas - Montis Cloud

**Sistema integral de gesti√≥n para restaurantes de √∫ltima generaci√≥n**

Plataforma completa desarrollada con React/Next.js (frontend) y Node.js/Express (backend), dise√±ada para optimizar todas las √°reas operativas de un restaurante: desde la toma de pedidos multi-canal hasta la gesti√≥n completa de recursos humanos, inventario avanzado por insumos, impresi√≥n t√©rmica profesional personalizable, y control total de acceso con roles y permisos granulares.

---

## üåü Caracter√≠sticas Destacadas

### üçΩÔ∏è Gesti√≥n Omnicanal de Pedidos

**Sistema Multi-Punto de Venta con Flujo Inteligente:**
- **Pedidos en Mesa**: Gesti√≥n cl√°sica con asignaci√≥n de m√∫ltiples mesas por comanda y vinculaci√≥n de mesero
- **Pedidos a Domicilio**: Captura completa de datos del cliente (nombre, direcci√≥n completa, tel√©fono de contacto)
- **Pedidos para Llevar**: Modalidad r√°pida sin requerimiento de direcci√≥n de entrega
- **UI Adaptativa**: Interfaz que se ajusta din√°micamente seg√∫n el tipo de pedido seleccionado
- **Edici√≥n de Comandas**: Agregar items adicionales a comandas existentes con impresi√≥n selectiva
- **M√∫ltiples Mesas**: Posibilidad de asignar varias mesas a una misma comanda

### üíº Frontend Moderno (React 18 + Next.js 14 + Tailwind CSS)

**Wizard Inteligente de 5 Pasos:**
1. **Selecci√≥n de Tipo de Pedido**: Mesa, Domicilio o Para Llevar con validaci√≥n contextual
2. **Asignaci√≥n de Recursos**: Selecci√≥n de mesa(s) o captura de datos del cliente seg√∫n tipo
3. **Tipo de Servicio**: Desayuno, Almuerzo o Carta Completa con men√∫s personalizados
4. **Cat√°logo de Productos**: Navegaci√≥n por categor√≠as con buscador r√°pido y gesti√≥n de cantidades
5. **Resumen y Confirmaci√≥n**: Vista previa detallada con observaciones generales y validaci√≥n final

**Sistema de Categorizaci√≥n Flexible:**
- üåÑ **Desayunos**: Con personalizaciones completas (bebidas, panes, acompa√±amientos, preparaciones)
- üçΩÔ∏è **Almuerzos**: Sistema de entradas, platos fuertes y postres personalizables
- üçï **Pizzas**: Con opciones de tama√±o y ingredientes adicionales
- ü•§ **Bebidas**: Clasificaci√≥n por tipo (calientes, fr√≠as, alcoh√≥licas)
- üç∞ **Postres**: Cat√°logo visual con opciones especiales
- üçî **Comida R√°pida**: Para pedidos express
- üçñ **Porciones Adicionales**: Complementos y extras

**Gesti√≥n Avanzada de Comandas:**
- ‚úÖ Visualizaci√≥n en tiempo real de comandas activas con totales autom√°ticos
- üìù Edici√≥n de comandas existentes con detecci√≥n inteligente de items nuevos
- üîÑ Sistema de estados: Pendiente ‚Üí Preparando ‚Üí Lista ‚Üí Entregada ‚Üí Completada
- ‚ùå Cancelaci√≥n de comandas con liberaci√≥n autom√°tica de mesas
- üìä Historial completo con filtros por fecha, estado, mesa y tipo de pedido
- üîç Buscador r√°pido por n√∫mero de comanda o cliente
- üì± Interfaz responsive optimizada para tablets y dispositivos m√≥viles

**Interfaz Profesional de Caja:**
- üí∞ Procesamiento de facturas con c√°lculo autom√°tico de IVA configurable
- üí≥ M√©todos de pago m√∫ltiples (Efectivo, Tarjeta, Transferencia, Mixto)
- üíµ Calculadora autom√°tica de cambio para pagos en efectivo
- üßæ Generaci√≥n de recibos de pago con detalle completo
- üìÑ Sistema de facturaci√≥n con encabezado empresarial personalizable
- ‚úì Pago parcial de items con tracking individual por producto
- üñ®Ô∏è Impresi√≥n autom√°tica de facturas y recibos t√©rmicos
- üìã Vista previa de facturaci√≥n antes de confirmar
- üîì Liberaci√≥n autom√°tica de mesas al completar pago

**Panel de Administraci√≥n Completo:**
- ‚öôÔ∏è **Configuraci√≥n del Sistema**: Par√°metros globales, modos de bloqueo de inventario
- üë• **Gesti√≥n de Usuarios**: CRUD completo con estados activo/inactivo
- üîê **Roles y Permisos**: Matriz de permisos granular por m√≥dulo y acci√≥n
- üë∑ **Gesti√≥n de Empleados**: Expediente digital completo del personal
- üíº **N√≥mina y Liquidaciones**: C√°lculo autom√°tico de pagos y prestaciones sociales
- üìù **Generaci√≥n de Contratos**: Creaci√≥n de documentos contractuales en PDF
- üè¢ **Datos de Empresa**: Informaci√≥n fiscal y de contacto para facturaci√≥n
- üßæ **Configuraci√≥n de Facturaci√≥n**: Par√°metros de IVA, responsabilidades fiscales
- üè† **Gesti√≥n de Salones**: Organizaci√≥n f√≠sica del restaurante
- ü™ë **Gesti√≥n de Mesas**: CRUD de mesas con capacidad y ubicaci√≥n
- üçï **Gesti√≥n de Productos**: Cat√°logo completo con inventario simple
- üè∑Ô∏è **Categor√≠as**: Organizaci√≥n de productos y personalizaciones
- ‚ú® **Personalizaciones**: Opciones configurables para productos personalizables
- üì¶ **Inventario Avanzado**: Sistema completo de insumos, recetas y ajustes
- üñ®Ô∏è **Configuraci√≥n de Impresi√≥n**: Selecci√≥n de impresoras, ancho de papel y tama√±o de fuente

**Experiencia de Usuario:**
- üì± **Dise√±o 100% Responsive**: Optimizado para escritorio, tablet y m√≥vil
- üé® **UI Moderna con Tailwind CSS**: Interfaz limpia, intuitiva y profesional
- üöÄ **Iconograf√≠a Lucide**: √çconos vectoriales de alta calidad
- ‚å®Ô∏è **Atajos de Teclado**: Navegaci√≥n r√°pida para operadores experimentados
- üîî **Notificaciones en Tiempo Real**: Alertas de estado de comandas e inventario
- üåô **Tema Personalizable**: Colores y branding adaptables
- ‚ôø **Accesibilidad**: Cumple con est√°ndares WCAG para inclusi√≥n

### ‚öôÔ∏è Backend Robusto (Node.js 18+ + Express 4 + PostgreSQL + TypeScript)

**API RESTful Enterprise-Grade:**
- üîå **Arquitectura Modular**: Separaci√≥n clara en routes, repositories, services y middleware
- üóÑÔ∏è **Base de Datos PostgreSQL**: Potente, escalable y con soporte completo de transacciones ACID
- üîÑ **Sistema de Migraciones**: Control de versiones de esquema con Kysely
- üõ°Ô∏è **Seguridad Robusta**: Autenticaci√≥n JWT, bcrypt para passwords, helmet para headers
- üìä **Transacciones**: Garant√≠a de consistencia en operaciones cr√≠ticas
- üöÄ **Compresi√≥n Gzip**: Respuestas optimizadas para mejor rendimiento
- üìù **Logging Completo**: Trazabilidad de operaciones y errores
- ‚ö° **Pool de Conexiones**: Gesti√≥n eficiente de conexiones a base de datos

**M√≥dulos y Funcionalidades:**

**üîê Autenticaci√≥n y Seguridad:**
- Sistema de login con sesiones JWT de larga duraci√≥n (12 horas)
- Middleware de autenticaci√≥n en todas las rutas protegidas
- Control de super-admin para operaciones cr√≠ticas
- Gesti√≥n de usuarios con estados y roles vinculados
- Matriz de permisos granular por m√≥dulo (Comandas, Productos, Inventario, Usuarios, etc.)

**üçΩÔ∏è Gesti√≥n Operativa:**
- CRUD completo de mesas con estados (disponible, ocupada, reservada)
- Gesti√≥n de salones con asignaci√≥n de mesas
- Cat√°logo de productos con inventario simple y por insumos
- Sistema de categor√≠as flexible y extensible
- Personalizaciones con precio adicional y ajustes de inventario
- Comandas multi-canal con soporte para edici√≥n y agregado de items
- Facturas con c√°lculo de IVA y m√∫ltiples m√©todos de pago

**üì¶ Inventario Inteligente:**
- **Insumos**: Stock con umbrales de m√≠nimo y cr√≠tico, estados autom√°ticos
- **Recetas por Producto**: Define qu√© insumos consume cada producto
- **Ajustes por Personalizaci√≥n**: Insumos extras o reducciones seg√∫n opciones
- **Descuento Autom√°tico**: Al confirmar comandas se resta stock de insumos
- **Historial de Movimientos**: Trazabilidad completa de consumos y ajustes
- **Indicadores de Riesgo**: Sistema de alertas (OK, BAJO, CR√çTICO, AGOTADO)
- **Bloqueo Configurable**: Prevenir ventas cuando inventario es insuficiente
- **Import/Export Excel**: Carga masiva y respaldo de insumos, recetas y productos

**üë• Recursos Humanos:**
- Expediente digital de empleados (datos personales, contractuales, salariales)
- C√°lculo autom√°tico de n√≥mina con devengados (horas extra, dominicales, festivos)
- Liquidaci√≥n de prestaciones sociales (cesant√≠as, intereses, primas, vacaciones)
- Generaci√≥n de contratos en PDF con plantillas personalizables
- Historial de liquidaciones con trazabilidad completa
- Par√°metros de ley actualizables (salario m√≠nimo, auxilio de transporte)

**üìä Reportes y An√°lisis:**
- Ventas por periodo, mesa, mesero y producto
- Estado de inventario con alertas de stock bajo/cr√≠tico
- Consumo de insumos por periodo
- Productos m√°s vendidos y menos vendidos
- An√°lisis de rentabilidad por producto
- Exportaci√≥n de reportes a Excel

**üîÑ Control de Estados y Flujos:**
- Estados de comandas con transiciones validadas
- Estados de mesas con liberaci√≥n autom√°tica post-facturaci√≥n
- Estados de empleados (activo, inactivo, liquidado)
- Estados de usuarios con control de acceso inmediato

### üë• Gesti√≥n de Recursos Humanos (N√≥mina y Personal)
- **Gesti√≥n de Empleados**: 
  - CRUD completo de personal con datos detallados (cargo, contrato, salario, etc.)
  - Control de estados y tipos de trabajadores
- **Liquidaci√≥n de N√≥mina**:
  - C√°lculo autom√°tico de devengados (horas extra, dominicales, festivos, comisiones)
  - Deducciones autom√°ticas (salud, pensi√≥n) y aportes de ley
  - Generaci√≥n de periodos mensuales y quincenales
- **Liquidaci√≥n de Prestaciones Sociales**:
  - C√°lculo de cesant√≠as, intereses, primas y vacaciones
  - Soporte para diferentes motivos de retiro (renuncia, despido con/sin justa causa)
  - Historial detallado de liquidaciones con trazabilidad

### üîê Seguridad y Control de Acceso (Usuarios y Roles)

**Autenticaci√≥n Robusta:**
- üîë **JWT Tokens**: Sesiones seguras con tokens firmados digitalmente
- ‚è∞ **Expiraci√≥n de 12 Horas**: Balance entre seguridad y experiencia de usuario
- üîê **Bcrypt Hashing**: Passwords encriptados con salt rounds para m√°xima seguridad
- üì± **Acceso por PIN**: Identificaci√≥n r√°pida con c√≥digo num√©rico para operaciones frecuentes
- üö™ **Logout Seguro**: Eliminaci√≥n de tokens y cierre de sesi√≥n
- üîÑ **Refresh Autom√°tico**: Validaci√≥n de sesi√≥n en cada solicitud
- üõ°Ô∏è **Middleware de Protecci√≥n**: Rutas protegidas por defecto, p√∫blicas por excepci√≥n

**Sistema de Roles y Permisos Granular (RBAC):**

**Roles del Sistema:**
- üëë **Super-Admin**: Control total incluyendo gesti√≥n de usuarios y roles
- üè¢ **Administrador**: Gesti√≥n operativa completa menos control de accesos
- üë®‚Äçüíº **Gerente**: Supervisi√≥n, reportes y configuraci√≥n limitada
- üë®‚Äçüç≥ **Cocinero**: Acceso a comandas y stock b√°sico
- üíº **Mesero**: Toma de pedidos y gesti√≥n de mesas
- üí∞ **Cajero**: Facturaci√≥n y cierres de caja

**Permisos por M√≥dulo (23 m√≥dulos configurables):**

| M√≥dulo | Ver | Crear | Editar | Eliminar | Especial |
|--------|-----|-------|--------|----------|----------|
| **Comandas** | ‚úì | ‚úì | ‚úì | ‚úì | Imprimir, Cambiar Estado |
| **Productos** | ‚úì | ‚úì | ‚úì | ‚úì | Gestionar Stock Simple |
| **Inventario** | ‚úì | ‚úì | ‚úì | ‚úì | Ajustes, Reportes |
| **Usuarios** | ‚úì | ‚úì | ‚úì | ‚úì | Gestionar Roles, Suplantar |
| **Empleados** | ‚úì | ‚úì | ‚úì | ‚úì | Ver Datos Salariales |
| **N√≥mina** | ‚úì | ‚úì | ‚úì | ‚úì | Calcular, Generar PDF |
| **Liquidaciones** | ‚úì | ‚úì | ‚úì | ‚úì | Calcular Prestaciones |
| **Reportes** | ‚úì | - | - | - | Exportar, An√°lisis Avanzado |
| **Configuraci√≥n** | ‚úì | - | ‚úì | - | Par√°metros, Impresoras |
| **Mesas** | ‚úì | ‚úì | ‚úì | ‚úì | Cambiar Estado, Asignar |
| **Facturas** | ‚úì | ‚úì | - | ‚úì | Anular, Imprimir |
| **Insumos** | ‚úì | ‚úì | ‚úì | ‚úì | Ajustes de Stock |
| **Recetas** | ‚úì | ‚úì | ‚úì | ‚úì | Vincular Insumos |

**Validaciones de Seguridad:**
- ‚úÖ Verificaci√≥n de token JWT en cada solicitud API
- ‚úÖ Validaci√≥n de permisos espec√≠ficos antes de ejecutar acciones
- ‚úÖ Protecci√≥n contra inyecci√≥n SQL con consultas preparadas (Kysely)
- ‚úÖ Sanitizaci√≥n de inputs en frontend y backend
- ‚úÖ Headers de seguridad con Helmet.js
- ‚úÖ CORS configurado y restrictivo
- ‚úÖ Rate limiting en endpoints sensibles
- ‚úÖ Logs de auditor√≠a para acciones cr√≠ticas

**Gesti√≥n Avanzada de Usuarios:**
- üìù **CRUD Completo**: Crear, leer, actualizar y eliminar usuarios
- üé≠ **Asignaci√≥n de Roles**: Vinculaci√≥n de rol √∫nico por usuario
- üîì **Estados de Usuario**: Activo/Inactivo con bloqueo inmediato de acceso
- üë§ **Integraci√≥n RRHH**: Vinculaci√≥n directa con expediente de empleado
- üëÄ **Suplantaci√≥n (Devtools)**: Super-admin puede tomar identidad para debugging
- üîç **Auditor√≠a**: Registro de √∫ltimo inicio de sesi√≥n y fecha de creaci√≥n
- üö´ **Auto-Protecci√≥n**: Los super-admin no pueden desactivarse a s√≠ mismos
- ‚ö†Ô∏è **Validaci√≥n de Eliminaci√≥n**: Previene eliminar usuarios con datos relacionados
- üîê **Cambio de Contrase√±a**: Requiere contrase√±a actual para actualizaci√≥n

**Roles Personalizables:**
- üé® **Creaci√≥n Din√°mica**: Define roles nuevos con nombre y descripci√≥n
- ‚öôÔ∏è **Configuraci√≥n Granular**: 23 permisos individuales configurables
- üìä **Nivel de Acceso**: Num√©rico para priorizar permisos (0-100)
- üîí **Roles Protegidos**: Super-admin es un rol del sistema inmutable
- üìã **Plantillas**: Copiar permisos de roles existentes para agilizar creaci√≥n
- üóëÔ∏è **Eliminaci√≥n Segura**: Solo si no hay usuarios asignados
- üìù **Edici√≥n en Vivo**: Cambios de permisos se aplican inmediatamente

### üñ®Ô∏è Sistema de Impresi√≥n Profesional y Configurable

**Plugin HTTP Propio (Puerto 8001):**
- üöÄ **Servidor Python Local**: Sin dependencias en la nube, sin marcas de agua
- üîå **API HTTP Simple**: Endpoint POST para env√≠o de comandos de impresi√≥n
- üñ®Ô∏è **Soporte ESC/POS Nativo**: Control total de impresoras t√©rmicas de 58mm y 80mm
- üîß **Instalaci√≥n Sencilla**: Script de compilaci√≥n a EXE para Windows
- üíæ **Configuraci√≥n Persistente**: LocalStorage guarda preferencias de impresi√≥n
- üîÑ **Auto-Detecci√≥n**: Lista autom√°tica de impresoras disponibles en el sistema
- üõ°Ô∏è **Fallback Robusto**: Log en consola si el plugin no est√° disponible

**Configuraci√≥n de Papel (58mm vs 80mm):**

| Ancho | Caracteres Normal | Caracteres Grande | Uso Recomendado |
|-------|-------------------|-------------------|-----------------|
| **58mm** | 32 caracteres | 16 caracteres | Comandas de cocina, tickets r√°pidos |
| **80mm** | 48 caracteres | 24 caracteres | Facturas, recibos detallados |

- üìè **Selector de Ancho**: Dropdown en panel de configuraci√≥n de facturaci√≥n
- üíæ **Persistencia**: Configuraci√≥n se guarda autom√°ticamente en navegador
- üîÑ **Cambio Din√°mico**: Ajuste en tiempo real del ancho de l√≠nea efectivo
- üìê **C√°lculo Autom√°tico**: Sistema ajusta separadores y alineaci√≥n seg√∫n ancho

**Configuraci√≥n de Tama√±o de Fuente:**

| Fuente | Comando ESC/POS | Factor | Ancho Real (80mm) | Ancho Real (58mm) |
|--------|-----------------|--------|-------------------|-------------------|
| **Peque√±a** | `\x1D\x21\x00` | 1x | 48 caracteres | 32 caracteres |
| **Normal** | `\x1D\x21\x00` | 1x | 48 caracteres | 32 caracteres |
| **Grande** | `\x1D\x21\x11` | 2x | **24 caracteres** | **16 caracteres** |

- üî§ **Selector de Fuente**: Options para Small, Normal y Large
- üìä **Ajuste Inteligente**: Fuente grande usa **mitad** del ancho efectivo
- ‚öôÔ∏è **Comandos ESC/POS**: 
  - `\x1D\x21\x00`: Tama√±o normal (1x ancho, 1x alto)
  - `\x1D\x21\x11`: Tama√±o grande (2x ancho, 2x alto)
- üî¢ **F√≥rmula Clave**: `ANCHO_EFECTIVO = fontSize === 'large' ? Math.floor(anchoBase / 2) : anchoBase`
- ‚úÖ **Sin Desbordamiento**: Separadores (=, -) se ajustan autom√°ticamente sin duplicarse

**Vista Previa en Tiempo Real:**
- üëÅÔ∏è **Preview Din√°mico**: Visualizaci√≥n exacta antes de imprimir
- üìÑ **Monospace Font**: Courier New para coincidencia perfecta con impresora
- üé® **Colores Diferenciados**: Background gris claro para simular papel
- üìè **Dimensiones Reales**: Respeta anchos de papel y fuentes configurados
- üîÑ **Actualizaci√≥n Instant√°nea**: Cambios de configuraci√≥n reflejan inmediatamente

**Encoding CP850 (Espa√±ol Optimizado):**
- √±, √ë ‚Üí Soporte nativo de e√±es
- √°, √©, √≠, √≥, √∫, √Å, √â, √ç, √ì, √ö ‚Üí Tildes correctas
- ¬ø, ¬° ‚Üí Signos de interrogaci√≥n y exclamaci√≥n invertidos
- $ ‚Üí S√≠mbolo de peso/d√≥lar
- ‚Ç¨ ‚Üí Euro (si est√° disponible)
- ¬∞ ‚Üí Grado para temperaturas

**Impresi√≥n Inteligente de Comandas:**

**üçΩÔ∏è Comandas Iniciales (Primera Impresi√≥n):**
```
========================================
COMANDA #12345
MESA: 5 - Sal√≥n Principal
MESERO: Juan P√©rez
HORA: 12:45 PM
========================================

2x Bandeja Paisa
   + Con arroz blanco
   + Sin frijoles

1x Jugo Natural
   + Mora
   + Sin az√∫car

========================================
OBSERVACIONES: Cliente al√©rgico a nueces
========================================
```

**‚ûï Items Adicionales (Impresi√≥n Selectiva):**
```
========================================
*** ITEMS ADICIONALES ***
COMANDA #12345 - MESA: 5
HORA: 13:15 PM
========================================

1x Caf√© Tinto

2x Postre del d√≠a
   + Con helado

========================================
‚ö†Ô∏è URGENTE - AGREGAR A PEDIDO
========================================
```

**Caracter√≠sticas de Impresi√≥n Selectiva:**
- ‚úÖ **Sin Duplicados**: Solo imprime productos que no tienen `is_impreso: true`
- üîÅ **Marca Autom√°tica**: Al imprimir, actualiza items a `is_impreso: true` en DB
- üéØ **Filtro Inteligente**: Compara estado en DB antes de generar impresi√≥n
- ‚ö° **Eficiencia**: Cocina solo ve lo nuevo, sin confusi√≥n de items anteriores
- üìù **Diferenciaci√≥n Visual**: Header especial "ITEMS ADICIONALES" con asteriscos
- ‚è∞ **Timestamp**: Hora exacta del agregado para control de tiempos

**Formatos de Documentos:**

**üìÑ Facturas (Invoice con IVA):**
```
=========================================
Casa Montis Restaurante
NIT: 900.123.456-7
Calle 123 #45-67, Bogot√°
Tel: (601) 234-5678
=========================================
FACTURA DE VENTA #00012345
Fecha: 15/01/2025 - 14:30
Mesero: Juan P√©rez
Mesa: 5 - Sal√≥n Principal
=========================================

CANT ARTICULO      V.UNIT   TOTAL
---- ------------- ------- -------
  2  Bandeja P...  $32,000 $64,000
  1  Jugo Natur... $8,000  $8,000
  1  Caf√© Tinto    $2,500  $2,500

=========================================
SUBTOTAL:                      $74,500
IVA (19%):                     $14,155
=========================================
TOTAL:                         $88,655
=========================================

M√©todo de Pago: Efectivo
Recibido: $90,000
Cambio: $1,345

=========================================
¬°Gracias por su visita!
Vuelva pronto
=========================================
```

**üßæ Recibos (Ticket Simplificado):**
```
=========================================
Casa Montis
=========================================
RECIBO #12345
15/01/2025 - 14:30
=========================================

CANT ARTICULO      V.UNIT   TOTAL
---- ------------- ------- -------
  2  Bandeja P...  $32,000 $64,000
  1  Jugo Natur... $8,000  $8,000

=========================================
TOTAL:                         $72,000
=========================================
Efectivo: $80,000
Cambio: $8,000
=========================================
```

**üöö Comandas para Domicilio (Datos Cliente):**
```
=========================================
üè† PEDIDO A DOMICILIO
=========================================
COMANDA #12345
HORA: 14:30 PM
=========================================
CLIENTE: Mar√≠a Gonz√°lez
DIR: Cra 15 #34-56, Apto 301
TEL: 321-456-7890
=========================================

2x Pizza Hawaiana
   + Extra queso
   + Borde relleno

1x Gaseosa Personal

=========================================
TOTAL PEDIDO: $48,000
=========================================
OBSERVACIONES:
Timbre no funciona, llamar al llegar
=========================================
```

**Comandos ESC/POS Utilizados:**
- `\x1B\x40` - Inicializar impresora
- `\x1B\x61\x01` - Centrar texto
- `\x1B\x61\x00` - Alinear izquierda
- `\x1B\x45\x01` - Negrita ON
- `\x1B\x45\x00` - Negrita OFF
- `\x1D\x21\x00` - Tama√±o normal (1x1)
- `\x1D\x21\x11` - Tama√±o grande (2x2)
- `\x1D\x21\x22` - Tama√±o extra grande (3x3)
- `\x1B\x64\x03` - Avanzar 3 l√≠neas
- `\x1B\x6A\xB4` - Cortar papel

**Manejo de Errores y Fallback:**
- ‚ö†Ô∏è **Detecci√≥n de Plugin**: Verifica disponibilidad antes de imprimir
- üìù **Log en Consola**: Si falla, muestra contenido en console.log
- üîî **Notificaci√≥n al Usuario**: Toast informando estado de impresi√≥n
- üîÑ **Reintento Autom√°tico**: Opci√≥n de reintentar impresi√≥n fallida
- üíæ **Cach√© Local**: Guarda √∫ltima configuraci√≥n v√°lida
- üõ†Ô∏è **Debug Mode**: Variable de entorno para logging detallado

## üìÅ Estructura Completa del Proyecto

```
Sistema-de-comandas-Casa-Montis/
‚îÇ
‚îú‚îÄ‚îÄ üìÇ frontend/                           # React 18 + Next.js 14 + Tailwind CSS
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/                          # App Router de Next.js 14
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ globals.css               # Estilos globales y Tailwind
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                # Layout ra√≠z de la aplicaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                  # P√°gina principal (/)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ factura/                  # Ruta para facturas
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ historial/                # Ruta de historial
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ impersonation-callback/   # Callback de suplantaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ recibo/                   # Ruta para recibos
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/                   # Componentes React
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SistemaPrincipal.tsx      # üè† Componente ra√≠z del sistema
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.tsx                 # üîê Interfaz de autenticaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Providers.tsx             # Providers de contextos globales
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserInfo.tsx              # Informaci√≥n del usuario logueado
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Onboarding.tsx            # Wizard de onboarding inicial
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FormularioComandas.tsx    # üìù Wizard multi-paso de 5 pasos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SeleccionTipoPedido.tsx   # ‚úÖ Paso 1: Mesa/Domicilio/Llevar
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SeleccionMesa.tsx         # ü™ë Paso 2: Selector de mesas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FormularioDatosCliente.tsx# üë§ Paso 2b: Datos de domicilio
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SeleccionTipoServicio.tsx # ‚òÄÔ∏è Paso 3: Categor√≠as de servicio
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SeleccionProductos.tsx    # üçΩÔ∏è Paso 4: Cat√°logo de productos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BuscadorProductos.tsx     # üîç Buscador de productos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ResumenComanda.tsx        # üìã Paso 5: Vista previa y env√≠o
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PersonalizacionProducto.tsx # ‚ú® Modal de personalizaciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InterfazCaja.tsx          # üí∞ Procesamiento de pagos y facturas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HistorialComandas.tsx     # üìú Historial completo de pedidos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Reportes.tsx              # üìä Reportes y an√°lisis
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImpersonationBanner.tsx   # üé≠ Banner de suplantaci√≥n activa
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Administracion.tsx        # Panel de administraci√≥n principal
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/                    # üõ†Ô∏è Panel de Administraci√≥n Completo
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConfiguracionSistema.tsx       # ‚öôÔ∏è Par√°metros del sistema
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GeneradorContratos.tsx         # üìÑ Generaci√≥n de PDFs de contrato
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionCategorias.tsx          # üè∑Ô∏è Categor√≠as de productos
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionEmpleados.tsx           # üë®‚Äçüíº CRUD de empleados (RRHH)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionEmpresa.tsx             # üè¢ Datos de la empresa
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionFacturacion.tsx         # üßæ Config de impresi√≥n (papel/fuente)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionInventarioAvanzado.tsx  # üì¶ Insumos, recetas, ajustes
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionLiquidacion.tsx         # üìä Liquidaciones finales
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionMesas.tsx               # ü™ë CRUD de mesas
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionNomina.tsx              # üíµ C√°lculo de n√≥mina mensual
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionPersonalizaciones.tsx   # ‚ú® Opciones personalizables
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionProductos.tsx           # üçï CRUD de productos con stock
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionRoles.tsx               # üé≠ CRUD de roles y permisos
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GestionSalones.tsx             # üè† CRUD de salones
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GestionUsuarios.tsx            # üë• CRUD de usuarios
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shared/                   # Componentes compartidos
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ PersonalizacionDisplay.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ usePersonalizaciones.ts
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contexts/                     # Contextos de React
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.tsx           # Estado de autenticaci√≥n global
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/                     # Servicios de API (Axios)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts                    # Cliente Axios configurado
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ printingService.ts        # Servicio de impresi√≥n
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/                        # TypeScript Types/Interfaces
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # Exportaciones centrales de tipos
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/                        # Utilidades
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ personalizacionUtils.ts   # Utilidades de personalizaciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ receiptFormatter.ts       # üñ®Ô∏è Formateador de recibos t√©rmicos
‚îÇ   ‚îÇ   ‚îÇ                                 #     (Soporta 58mm/80mm, fuente small/normal/large)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants/                    # Constantes
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ inventory.ts              # Constantes de inventario
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ .eslintrc.json                    # Configuraci√≥n de ESLint
‚îÇ   ‚îú‚îÄ‚îÄ .env.local                        # Variables de entorno locales
‚îÇ   ‚îú‚îÄ‚îÄ next.config.js                    # Configuraci√≥n de Next.js
‚îÇ   ‚îú‚îÄ‚îÄ postcss.config.js                 # Configuraci√≥n de PostCSS
‚îÇ   ‚îú‚îÄ‚îÄ tailwind.config.js                # Configuraci√≥n de Tailwind
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json                     # Config de TypeScript
‚îÇ   ‚îî‚îÄ‚îÄ package.json                      # Dependencias del frontend
‚îÇ
‚îú‚îÄ‚îÄ üìÇ admin-panel/                        # Admin Panel Independiente (Next.js 14)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/                          # App Router
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/                # Dashboard administrativo
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ login/                    # Ruta de login
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Impersonation.tsx         # üé≠ Componente de suplantaci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useImpersonation.ts       # Hook para super-admin
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/                     # Servicios de API
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ next-env.d.ts
‚îÇ   ‚îú‚îÄ‚îÄ next.config.js
‚îÇ   ‚îú‚îÄ‚îÄ postcss.config.js
‚îÇ   ‚îú‚îÄ‚îÄ tailwind.config.js
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ üìÇ backend/                            # Node.js 18+ + Express 4 + PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts                      # Punto de entrada del servidor
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/                       # Configuraciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ envValidator.ts           # Validador de variables de entorno
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database/                     # Capa de base de datos (PostgreSQL)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.ts               # Conexi√≥n a PostgreSQL con Pool
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ init.ts                   # Inicializaci√≥n de DB
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrator.ts               # Sistema de migraciones (Kysely)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reset.ts                  # Reset de base de datos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types.ts                  # Tipos de base de datos
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations/               # Migraciones SQL versionadas
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/                   # Middleware de Express
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authMiddleware.ts         # üîê Verificaci√≥n JWT y permisos
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ superAdminMiddleware.ts   # üëë Middleware de super-admin
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/                       # Tipos y modelos TypeScript
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # Exportaciones de modelos
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/                 # Capa de datos (Repository Pattern)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categoriaRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comandaRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ configFacturacionRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ empresaRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ facturaRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ licenciaRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mesaRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nominaRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productoRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reporteRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ salonRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuarioRepository.ts
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/                       # Rutas de API REST
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.ts                  # Rutas administrativas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts                   # POST /api/auth/login, /logout
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categorias.ts             # CRUD /api/categorias
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comandas.ts               # CRUD /api/comandas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ configuracion-facturacion.ts # GET/PUT /api/configuracion-facturacion
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ configuracion-sistema.ts  # GET/PUT /api/configuracion-sistema
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contratos.ts              # POST /api/contratos/generar
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ empleados.ts              # CRUD /api/empleados
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ facturas.ts               # POST /api/facturas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ insumo-categorias.ts      # Categor√≠as de insumos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inventario-avanzado.ts    # Insumos, recetas, ajustes, historial
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mesas.ts                  # CRUD /api/mesas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nomina.ts                 # CRUD /api/nomina (liquidaciones)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ onboarding.ts             # Wizard de onboarding
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ personalizaciones.ts      # CRUD /api/personalizaciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productos.ts              # CRUD /api/productos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ proveedores.ts            # CRUD de proveedores
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reportes.ts               # GET /api/reportes/ventas, /inventario
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ roles.ts                  # CRUD /api/roles
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ salones.ts                # CRUD /api/salones
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sistema.ts                # GET /api/sistema/info
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuarios.ts               # CRUD /api/usuarios
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scripts/                      # Scripts administrativos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audit-db-schema.ts        # Auditor√≠a de esquema BD
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audit-routes.ts           # Auditor√≠a de rutas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audit-schema.ts           # Auditor√≠a general
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrate.ts                # Ejecutor de migraciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test-saas-isolation.ts    # Tests de aislamiento multi-tenant
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/                     # Servicios de l√≥gica de negocio
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authService.ts            # Servicio de autenticaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categoriaService.ts       # Servicio de categor√≠as
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comandaService.ts         # Servicio de comandas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ facturaService.ts         # Servicio de facturaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inventarioService.ts      # Servicio de inventario
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mesaService.ts            # Servicio de mesas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NominaService.ts          # üíµ C√°lculos de n√≥mina y prestaciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ onboardingService.ts      # Servicio de onboarding
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productoService.ts        # Servicio de productos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reporteService.ts         # Servicio de reportes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ saasAdminService.ts       # Servicio de administraci√≥n SaaS
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ salonService.ts           # Servicio de salones
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuarioService.ts         # Servicio de usuarios
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/                        # Tipos compartidos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ express.d.ts              # Extensiones de tipos Express
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ saas-admin.types.ts       # Tipos de administraci√≥n SaaS
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/                        # Utilidades
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dateUtils.ts              # Parseo y formateo de fechas
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ inventoryValidation.ts    # Validaci√≥n de stock antes de venta
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ numeroALetras.ts          # Conversi√≥n de n√∫meros a texto espa√±ol
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ data/                             # Datos de importaci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ productos_casa_montis.json    # Dump de productos para importar
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ modelo_imprimir_legacy/           # Sistema legacy de impresi√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pluginImpresora.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ printer.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ scripts/                          # Scripts de administraci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ verificar-permisos-sistema.sql # Script SQL de verificaci√≥n
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ storage/                          # Archivos generados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contratos/                    # PDFs de contratos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ nomina_pdfs/                  # PDFs de n√≥minas
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ temp/                             # Archivos temporales de testing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ check-db.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test-server.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...                           # Otros scripts de prueba
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ .env                              # Variables de entorno (no commiteado)
‚îÇ   ‚îú‚îÄ‚îÄ .env.example                      # Ejemplo de variables de entorno
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore
‚îÇ   ‚îú‚îÄ‚îÄ CONTRATO.TXT                      # Template de contrato
‚îÇ   ‚îú‚îÄ‚îÄ package.json                      # Dependencias del backend
‚îÇ   ‚îî‚îÄ‚îÄ tsconfig.json                     # Config de TypeScript
‚îÇ
‚îú‚îÄ‚îÄ üìÇ local-print-plugin/                 # üñ®Ô∏è Plugin de Impresi√≥n HTTP (Python)
‚îÇ   ‚îú‚îÄ‚îÄ build/                            # Carpeta de compilaci√≥n PyInstaller
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CasaMontis-PrintPlugin/       # Archivos intermedios de build
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ server.py                         # Servidor Flask en puerto 8001
‚îÇ   ‚îú‚îÄ‚îÄ server_backup.js                  # Backup legacy en Node.js
‚îÇ   ‚îú‚îÄ‚îÄ test_plugin.py                    # Tests del plugin
‚îÇ   ‚îú‚îÄ‚îÄ build_exe.py                      # Script para compilar a EXE
‚îÇ   ‚îú‚îÄ‚îÄ CasaMontis-PrintPlugin.spec       # Spec para PyInstaller
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt                  # Dependencias Python (flask, pywin32)
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore                        # Archivos ignorados
‚îÇ   ‚îú‚îÄ‚îÄ README.md                         # Documentaci√≥n del plugin
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ INICIAR_PLUGIN.bat                # üöÄ Script de inicio r√°pido
‚îÇ   ‚îú‚îÄ‚îÄ COMPILAR_A_EXE.bat                # üî® Script de compilaci√≥n a EXE
‚îÇ   ‚îú‚îÄ‚îÄ PROBAR_PLUGIN.bat                 # üß™ Script de pruebas
‚îÇ   ‚îî‚îÄ‚îÄ LIMPIAR_LEGACY.bat                # üßπ Limpiar archivos legacy
‚îÇ
‚îú‚îÄ‚îÄ üìÇ GUIA DE USO/                        # üìö Documentaci√≥n del Sistema
‚îÇ   ‚îú‚îÄ‚îÄ GUIA_DE_USO.md                    # Gu√≠a general del sistema
‚îÇ   ‚îú‚îÄ‚îÄ ACCESO_RED_LOCAL.md               # Configuraci√≥n de red local
‚îÇ   ‚îú‚îÄ‚îÄ ARREGLOS-GESTION-NOMINA.md        # Fixes de n√≥mina
‚îÇ   ‚îú‚îÄ‚îÄ CAMBIO_DE_MESA.md                 # Funcionalidad de cambiar mesa
‚îÇ   ‚îú‚îÄ‚îÄ CAMBIOS_BUSCADOR_PRODUCTOS.md     # Filtros de b√∫squeda
‚îÇ   ‚îú‚îÄ‚îÄ CONSOLIDACION_SAAS.md             # Arquitectura multi-tenant
‚îÇ   ‚îú‚îÄ‚îÄ DOMICILIOS.md                     # Flujo de pedidos a domicilio
‚îÇ   ‚îú‚îÄ‚îÄ INVENTARIO_PRODUCTOS.md           # Sistema de stock simple
‚îÇ   ‚îú‚îÄ‚îÄ PLUGIN_IMPRESION.md               # Uso del plugin de impresi√≥n
‚îÇ   ‚îú‚îÄ‚îÄ REFACTORIZACION_ADMINISTRACION.md # Cambios en admin panel
‚îÇ   ‚îî‚îÄ‚îÄ SISTEMA_INVENTARIO_PERSONALIZACIONES.md # Inventario avanzado
‚îÇ
‚îú‚îÄ‚îÄ .gitignore                             # Archivos ignorados por Git
‚îú‚îÄ‚îÄ .git/                                  # Repositorio Git
‚îú‚îÄ‚îÄ iniciador_automatico.bat               # üöÄ Script de inicio r√°pido
‚îÇ                                          #     (Solo Backend + Frontend en desarrollo)
‚îú‚îÄ‚îÄ setup_completo.bat                     # üîß Script de instalaci√≥n completa
‚îÇ                                          #     (Instala todo + Migra BD + Inicia 4 servicios)
‚îÇ
‚îî‚îÄ‚îÄ README.md                              # üìñ Este archivo - Documentaci√≥n principal
```

## üõ†Ô∏è Instalaci√≥n y Configuraci√≥n

### üìã Requisitos Previos

**Software Obligatorio:**
- ‚úÖ **Node.js 18+** (LTS recomendado) - [Descargar](https://nodejs.org/)
- ‚úÖ **PostgreSQL 14+** - [Descargar](https://www.postgresql.org/download/)
- ‚úÖ **npm** o **yarn** (incluido con Node.js)
- ‚úÖ **Git** (para clonar el repositorio)

**Software Opcional:**
- üñ®Ô∏è **Impresora T√©rmica ESC/POS** (58mm o 80mm)
- üêç **Python 3.9+** (para plugin de impresi√≥n)
- üìÑ **pgAdmin 4** (para administrar PostgreSQL visualmente)

---

### üöÄ Instalaci√≥n R√°pida con Script Autom√°tico (Windows)

#### Opci√≥n A: Setup Completo (Primera vez)

```bash
# 1. Clonar el repositorio
git clone https://github.com/Juanshiu/Sistema-de-comandas-Casa-Montis
cd Sistema-de-comandas-Casa-Montis

# 2. Configurar PostgreSQL primero (ver secci√≥n abajo)
# Crear base de datos y usuario

# 3. Configurar variables de entorno
cd backend
copy .env.example .env
# Editar backend\.env con tus credenciales de PostgreSQL
cd ..

# 4. Ejecutar setup completo
setup_completo.bat
```

**El script `setup_completo.bat` har√°:**
1. ‚úÖ Instalar dependencias de backend (npm install)
2. ‚úÖ Instalar dependencias de frontend (npm install)
3. ‚úÖ Instalar dependencias de admin-panel (npm install)
4. ‚úÖ Instalar dependencias del plugin Python (pip install)
5. ‚úÖ Ejecutar migraciones de base de datos
6. ‚úÖ Iniciar plugin de impresi√≥n (puerto 8001)
7. ‚úÖ Iniciar backend (puerto 3001)
8. ‚úÖ Iniciar frontend (puerto 3000)
9. ‚úÖ Iniciar admin-panel (puerto 3002)

#### Opci√≥n B: Inicio R√°pido (Ya configurado)

Si ya instalaste dependencias y configuraste todo, usa el iniciador r√°pido:

```bash
iniciador_automatico.bat
```

**El script `iniciador_automatico.bat` solo har√°:**
- üöÄ Iniciar backend en modo desarrollo (puerto 3001)
- üöÄ Iniciar frontend en modo desarrollo (puerto 3000)

**Nota:** Para incluir admin-panel y plugin de impresi√≥n en el inicio r√°pido, usa `setup_completo.bat`

---

### ‚öôÔ∏è Instalaci√≥n Manual Paso a Paso

#### 1Ô∏è‚É£ **Configurar PostgreSQL**

```bash
# Iniciar PostgreSQL y crear base de datos
psql -U postgres

CREATE DATABASE casa_montis;
CREATE USER casa_montis_user WITH PASSWORD 'tu_password_segura';
GRANT ALL PRIVILEGES ON DATABASE casa_montis TO casa_montis_user;
\q
```

#### 2Ô∏è‚É£ **Backend (Node.js + Express + PostgreSQL)**

```bash
cd backend

# Instalar dependencias
npm install

# Configurar variables de entorno
cp .env.example .env
# Editar .env con tus credenciales de PostgreSQL
```

**Contenido del archivo `backend/.env`:**

```env
# Puerto del servidor
PORT=3001

# Base de Datos PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_USER=casa_montis_user
DB_PASSWORD=tu_password_segura
DB_NAME=casa_montis

# JWT para autenticaci√≥n
JWT_SECRET=tu_clave_secreta_muy_larga_y_aleatoria_aqui_min_32_caracteres

# Plugin de Impresi√≥n
ESC_POS_URL=http://localhost:8001/imprimir
PRINTER_COCINA_NAME=pos58
PRINTER_CAJA_NAME=pos58

# Entorno
NODE_ENV=development
```

```bash
# Ejecutar migraciones de base de datos
npm run migrate

# Compilar TypeScript
npm run build

# Iniciar servidor en modo desarrollo
npm run dev

# O en modo producci√≥n
npm start
```

**Scripts npm del backend:**
- `npm start` - Inicia en modo producci√≥n (requiere build previo)
- `npm run dev` - Inicia con hot-reload (nodemon + ts-node)
- `npm run build` - Compila TypeScript a JavaScript
- `npm run migrate` - Ejecuta migraciones de BD
- `npm run reset-db` - **PELIGRO**: Resetea completamente la base de datos

#### 3Ô∏è‚É£ **Frontend (Next.js 14 + React 18 + Tailwind)**

```bash
cd frontend

# Instalar dependencias
npm install

# Iniciar en modo desarrollo
npm run dev

# O compilar para producci√≥n
npm run build
npm start
```

**Configuraci√≥n en `frontend/.env.local` (opcional):**

```env
NEXT_PUBLIC_API_URL=http://localhost:3001/api
NEXT_PUBLIC_PRINT_PLUGIN_URL=http://localhost:8001
```

**Scripts npm de frontend:**
- `npm run dev` - Servidor de desarrollo en puerto 3000
- `npm run build` - Build de producci√≥n optimizado
- `npm start` - Inicia build de producci√≥n
- `npm run lint` - Ejecuta ESLint

#### 4Ô∏è‚É£ **Admin Panel (Next.js 14 + Independiente)**

```bash
cd admin-panel

# Instalar dependencias
npm install

# Iniciar en modo desarrollo (puerto 3002)
npm run dev
```

#### 5Ô∏è‚É£ **Plugin de Impresi√≥n (Python + Flask)**

```bash
cd local-print-plugin

# Instalar Python 3.9+ si no lo tienes
# Descargar desde https://www.python.org/downloads/

# Instalar dependencias
pip install -r requirements.txt

# Iniciar plugin
python server.py
```

**O usar el script de Windows:**

```bash
INICIAR_PLUGIN.bat
```

**O compilar a EXE para distribuci√≥n:**

```bash
COMPILAR_A_EXE.bat
```

El EXE compilado estar√° en `build/CasaMontis-PrintPlugin/CasaMontis-PrintPlugin.exe`

**Configuraci√≥n del Plugin:**
- üîå **Puerto**: 8001
- üñ®Ô∏è **Endpoint**: `POST http://localhost:8001/imprimir`
- üìù **Body**: JSON con `{ "printer": "nombre_impresora", "text": "contenido_a_imprimir" }`
- üìã **Listar impresoras**: `GET http://localhost:8001/printers`

---

### üñ®Ô∏è Configuraci√≥n de Impresoras T√©rmicas

**1. Instalar driver de tu impresora t√©rmica**
- Conectar impresora v√≠a USB
- Instalar drivers del fabricante
- Configurar como impresora predeterminada o anotar el nombre exacto

**2. Verificar nombre de impresora en Windows:**

```powershell
# PowerShell
Get-Printer | Select-Object Name

# O en Panel de Control > Dispositivos e impresoras
```

**3. Configurar en panel de facturaci√≥n:**
- Ir a Admin Panel (http://localhost:3002)
- Login como super-admin
- Ir a "Gesti√≥n de Facturaci√≥n"
- Seleccionar tu impresora del dropdown
- Elegir ancho de papel: **58mm** o **80mm**
- Elegir tama√±o de fuente: **Small**, **Normal** o **Large**
- Guardar configuraci√≥n (se persiste en localStorage)

**4. Probar impresi√≥n:**
- Click en bot√≥n "Probar Impresora"
- Debe salir ticket de prueba con configuraci√≥n actual
- Si falla, verificar que plugin est√© corriendo en puerto 8001

---

## üöÄ Ejecuci√≥n del Sistema

### ‚ö° Modo Desarrollo (Recomendado para Testing)

**Opci√≥n 1: Iniciador Autom√°tico (Windows)**

```bash
# Inicia TODO el sistema con un solo comando
iniciador_automatico.bat
```

**Opci√≥n 2: Iniciar Manualmente**

```bash
# Terminal 1: Backend (puerto 3001)
cd backend
npm run dev

# Terminal 2: Frontend (puerto 3000)
cd frontend
npm run dev

# Terminal 3: Admin Panel (puerto 3002)
cd admin-panel
npm run dev

# Terminal 4: Plugin de Impresi√≥n (puerto 8001)
cd local-print-plugin
python server.py
# O ejecutar: INICIAR_PLUGIN.bat
```

---

### üèóÔ∏è Modo Producci√≥n

```bash
# 1. Compilar Backend
cd backend
npm run build

# 2. Compilar Frontend
cd frontend
npm run build

# 3. Compilar Admin Panel
cd admin-panel
npm run build

# 4. Compilar Plugin a EXE
cd local-print-plugin
COMPILAR_A_EXE.bat

# 5. Iniciar servicios (usar PM2 o similar para mantener activos)
cd backend && npm start
cd frontend && npm start
cd admin-panel && npm start
# Ejecutar CasaMontis-PrintPlugin.exe
```

---

### üåê URLs de Acceso

| Servicio | URL | Descripci√≥n |
|----------|-----|-------------|
| **Frontend** | http://localhost:3000 | Interfaz principal de comandas |
| **Admin Panel** | http://localhost:3002 | Panel de administraci√≥n |
| **API Backend** | http://localhost:3001/api | API RESTful |
| **Health Check** | http://localhost:3001/health | Estado del servidor |
| **Print Plugin** | http://localhost:8001 | Plugin de impresi√≥n |
| **Printers List** | http://localhost:8001/printers | Lista de impresoras |

---

## üìä Documentaci√≥n de API Endpoints

### üîê Autenticaci√≥n

| M√©todo | Endpoint | Descripci√≥n | Autenticaci√≥n |
|--------|----------|-------------|---------------|
| POST | `/api/auth/login` | Iniciar sesi√≥n | No |
| POST | `/api/auth/logout` | Cerrar sesi√≥n | S√≠ |

**Ejemplo de Login:**

```json
POST /api/auth/login
{
  "username": "admin",
  "password": "admin123"
}

// Respuesta:
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "username": "admin",
    "nombre": "Administrador",
    "rol": "super-admin"
  }
}
```

---

### ü™ë Mesas y Salones

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/mesas` | Listar todas las mesas | `mesas.ver` |
| GET | `/api/mesas/:id` | Obtener mesa espec√≠fica | `mesas.ver` |
| POST | `/api/mesas` | Crear nueva mesa | `mesas.crear` |
| PUT | `/api/mesas/:id` | Actualizar mesa | `mesas.editar` |
| PATCH | `/api/mesas/:id` | Cambiar estado de mesa | `mesas.editar` |
| DELETE | `/api/mesas/:id` | Eliminar mesa | `mesas.eliminar` |
| GET | `/api/salones` | Listar todos los salones | `mesas.ver` |
| POST | `/api/salones` | Crear nuevo sal√≥n | `mesas.crear` |
| PUT | `/api/salones/:id` | Actualizar sal√≥n | `mesas.editar` |
| DELETE | `/api/salones/:id` | Eliminar sal√≥n | `mesas.eliminar` |

---

### üçΩÔ∏è Productos y Categor√≠as

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/productos` | Listar todos los productos | `productos.ver` |
| GET | `/api/productos/:id` | Obtener producto espec√≠fico | `productos.ver` |
| GET | `/api/productos/categoria/:cat` | Filtrar por categor√≠a | `productos.ver` |
| POST | `/api/productos` | Crear producto | `productos.crear` |
| PUT | `/api/productos/:id` | Actualizar producto | `productos.editar` |
| DELETE | `/api/productos/:id` | Eliminar producto | `productos.eliminar` |
| GET | `/api/categorias` | Listar categor√≠as | `productos.ver` |
| POST | `/api/categorias` | Crear categor√≠a | `productos.crear` |
| PUT | `/api/categorias/:id` | Actualizar categor√≠a | `productos.editar` |
| DELETE | `/api/categorias/:id` | Eliminar categor√≠a | `productos.eliminar` |

---

### üìù Comandas (Pedidos)

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/comandas` | Listar todas las comandas | `comandas.ver` |
| GET | `/api/comandas/activas` | Comandas activas con items | `comandas.ver` |
| GET | `/api/comandas/historial` | Historial completo | `comandas.ver` |
| GET | `/api/comandas/:id` | Obtener comanda con items | `comandas.ver` |
| POST | `/api/comandas` | Crear comanda (imprime auto) | `comandas.crear` |
| PUT | `/api/comandas/:id` | Agregar items adicionales | `comandas.editar` |
| PATCH | `/api/comandas/:id/estado` | Cambiar estado | `comandas.editar` |
| DELETE | `/api/comandas/:id` | Eliminar comanda | `comandas.eliminar` |
| POST | `/api/comandas/:id/imprimir` | Reimprimir comanda | `comandas.imprimir` |

**Crear Comanda (POST /api/comandas):**

```json
{
  "tipo_pedido": "mesa",  // o "domicilio", "para_llevar"
  "mesa_id": 5,
  "mesero": "Juan P√©rez",
  "observaciones": "Cliente al√©rgico a nueces",
  "items": [
    {
      "producto_id": 10,
      "cantidad": 2,
      "precio_unitario": 32000,
      "personalizaciones": [
        {"personalizacion_id": 1, "precio_adicional": 0}
      ]
    }
  ],
  // Solo para domicilios:
  "cliente_nombre": "Mar√≠a Gonz√°lez",
  "cliente_telefono": "321-456-7890",
  "cliente_direccion": "Cra 15 #34-56, Apto 301"
}
```

---

### üí∞ Facturas

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/facturas` | Listar facturas | `facturas.ver` |
| GET | `/api/facturas/:id` | Obtener factura espec√≠fica | `facturas.ver` |
| POST | `/api/facturas` | Crear factura y liberar mesa | `facturas.crear` |
| POST | `/api/facturas/:id/imprimir` | Reimprimir factura | `facturas.imprimir` |

**Crear Factura (POST /api/facturas):**

```json
{
  "comanda_id": 123,
  "metodo_pago": "efectivo",  // o "tarjeta", "transferencia"
  "aplicar_iva": true,
  "valor_recibido": 100000,
  "descuento": 0
}
```

---

### üì¶ Inventario Avanzado

**Insumos:**

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/inventario-avanzado/insumos` | Listar insumos | `inventario.ver` |
| POST | `/api/inventario-avanzado/insumos` | Crear insumo | `inventario.crear` |
| PUT | `/api/inventario-avanzado/insumos/:id` | Actualizar insumo | `inventario.editar` |
| DELETE | `/api/inventario-avanzado/insumos/:id` | Eliminar insumo | `inventario.eliminar` |
| POST | `/api/inventario-avanzado/insumos/:id/ajuste` | Ajuste manual de stock | `inventario.ajustes` |
| GET | `/api/inventario-avanzado/insumos/historial` | Historial de movimientos | `inventario.ver` |

**Recetas:**

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/inventario-avanzado/recetas/productos/:id` | Obtener receta de producto | `inventario.ver` |
| PUT | `/api/inventario-avanzado/recetas/productos/:id` | Guardar receta de producto | `inventario.editar` |
| GET | `/api/inventario-avanzado/recetas/personalizaciones/:id` | Ajustes de personalizaci√≥n | `inventario.ver` |
| PUT | `/api/inventario-avanzado/recetas/personalizaciones/:id` | Guardar ajustes | `inventario.editar` |

**Indicadores de Riesgo:**

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/inventario-avanzado/riesgo/productos` | Estado de riesgo por producto | `inventario.ver` |
| GET | `/api/inventario-avanzado/riesgo/personalizaciones` | Estado por personalizaci√≥n | `inventario.ver` |

**Import/Export:**

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/inventario-avanzado/insumos/export` | Exportar insumos (Excel) | `inventario.ver` |
| POST | `/api/inventario-avanzado/insumos/import` | Importar insumos (Excel) | `inventario.editar` |
| GET | `/api/inventario-avanzado/recetas/export` | Exportar recetas (Excel) | `inventario.ver` |
| POST | `/api/inventario-avanzado/recetas/import` | Importar recetas (Excel) | `inventario.editar` |
| GET | `/api/inventario-avanzado/productos/export` | Exportar productos (Excel) | `inventario.ver` |
| POST | `/api/inventario-avanzado/productos/import` | Importar productos (Excel) | `inventario.editar` |

---

### üë• Recursos Humanos (RRHH)

**Empleados:**

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/empleados` | Listar empleados | `empleados.ver` |
| GET | `/api/empleados/:id` | Obtener empleado espec√≠fico | `empleados.ver` |
| POST | `/api/empleados` | Registrar empleado | `empleados.crear` |
| PUT | `/api/empleados/:id` | Actualizar empleado | `empleados.editar` |
| DELETE | `/api/empleados/:id` | Eliminar empleado | `empleados.eliminar` |

**N√≥mina:**

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/nomina/configuracion` | Obtener par√°metros de ley | `nomina.ver` |
| POST | `/api/nomina/calcular` | Calcular n√≥mina de empleado | `nomina.calcular` |
| GET | `/api/nomina/historial/:empleadoId` | Historial de n√≥minas | `nomina.ver` |
| POST | `/api/nomina/generar-pdf/:nominaId` | Generar PDF de n√≥mina | `nomina.generar_pdf` |

**Liquidaciones:**

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| POST | `/api/nomina/liquidar` | Calcular liquidaci√≥n final | `liquidaciones.calcular` |
| GET | `/api/nomina/liquidaciones/:empleadoId` | Historial de liquidaciones | `liquidaciones.ver` |
| POST | `/api/nomina/liquidaciones/generar-pdf/:id` | Generar PDF | `liquidaciones.generar_pdf` |

**Contratos:**

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| POST | `/api/contratos/generar` | Generar contrato en PDF | `empleados.crear` |

---

### üë§ Usuarios y Roles

**Usuarios:**

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/usuarios` | Listar usuarios | `usuarios.ver` |
| GET | `/api/usuarios/:id` | Obtener usuario espec√≠fico | `usuarios.ver` |
| POST | `/api/usuarios` | Crear usuario | `usuarios.crear` |
| PUT | `/api/usuarios/:id` | Actualizar usuario | `usuarios.editar` |
| DELETE | `/api/usuarios/:id` | Eliminar usuario | `usuarios.eliminar` |
| POST | `/api/usuarios/:id/cambiar-password` | Cambiar contrase√±a | `usuarios.editar` |

**Roles:**

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/roles` | Listar roles | `roles.ver` |
| GET | `/api/roles/:id` | Obtener rol con permisos | `roles.ver` |
| POST | `/api/roles` | Crear rol personalizado | `roles.crear` |
| PUT | `/api/roles/:id` | Actualizar permisos de rol | `roles.editar` |
| DELETE | `/api/roles/:id` | Eliminar rol | `roles.eliminar` |

---

### üìà Reportes

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/reportes/ventas` | Reporte de ventas por periodo | `reportes.ver` |
| GET | `/api/reportes/inventario` | Estado de inventario | `reportes.ver` |
| GET | `/api/reportes/productos-mas-vendidos` | Top productos vendidos | `reportes.ver` |
| GET | `/api/reportes/ventas-por-mesero` | Ventas por mesero | `reportes.ver` |
| GET | `/api/reportes/ventas-por-mesa` | Ventas por mesa | `reportes.ver` |
| GET | `/api/reportes/export-excel` | Exportar reporte a Excel | `reportes.exportar` |

---

### ‚öôÔ∏è Configuraci√≥n del Sistema

| M√©todo | Endpoint | Descripci√≥n | Permisos |
|--------|----------|-------------|----------|
| GET | `/api/configuracion-sistema` | Obtener configuraci√≥n | `configuracion.ver` |
| PUT | `/api/configuracion-sistema` | Actualizar configuraci√≥n | `configuracion.editar` |
| GET | `/api/configuracion-facturacion` | Config de impresi√≥n | `configuracion.ver` |
| PUT | `/api/configuracion-facturacion` | Actualizar config impresi√≥n | `configuracion.editar` |
| GET | `/api/sistema/info` | Informaci√≥n del sistema | P√∫blico |
| GET | `/health` | Health check | P√∫blico |

---
- `GET /api/configuracion/sistema` - Obtener configuraci√≥n
- `PUT /api/configuracion/sistema` - Actualizar configuraci√≥n (`critico_modo`)

### Personalizaciones
- `GET /api/personalizaciones/categorias` - Obtener categor√≠as de personalizaci√≥n
- `POST /api/personalizaciones/categorias` - Crear categor√≠a
- `GET /api/personalizaciones/opciones` - Obtener opciones por categor√≠a
- `POST /api/personalizaciones/opciones` - Crear opci√≥n

### Plugin de Impresi√≥n (Puerto 8001)
- `POST /imprimir` - Imprimir contenido con encoding CP850
- `POST /probar` - Probar impresora con texto de ejemplo
- `GET /status` - Estado del servicio de impresi√≥n

## üí° Flujo de Trabajo Detallado

### üçΩÔ∏è Pedidos en Mesa

1. **Selecci√≥n de Tipo**: Usuario elige "Mesa"
2. **Selecci√≥n de Mesa(s)**: Se pueden asignar m√∫ltiples mesas a una misma comanda
3. **Tipo de Servicio**: Desayuno, Almuerzo, o Carta Completa
4. **Selecci√≥n de Productos**:
   - Desayuno: Formulario especializado con personalizaciones (bebidas, panes, acompa√±amientos)
   - Almuerzo: Formulario con opciones de entrada, principal, acompa√±amientos, postre
   - Carta Completa: Selecci√≥n libre de cualquier producto del men√∫
5. **Resumen y Env√≠o**: Vista previa con todas las opciones seleccionadas
6. **Impresi√≥n Autom√°tica**: Comanda se imprime en cocina autom√°ticamente

### üè† Pedidos a Domicilio / Para Llevar

1. **Selecci√≥n de Tipo**: Usuario elige "Domicilio"
2. **Datos del Cliente**:
   - Nombre (requerido)
   - Direcci√≥n (requerida para delivery, opcional para pickup)
   - Tel√©fono (opcional)
   - Checkbox "¬øEs para llevar?" (si se marca, no se requiere direcci√≥n)
3. **Tipo de Servicio**: Igual que mesa
4. **Selecci√≥n de Productos**: Igual que mesa
5. **Resumen y Env√≠o**: Muestra datos del cliente en lugar de mesas
6. **Impresi√≥n**: Ticket incluye claramente datos del cliente y direcci√≥n

### ‚úèÔ∏è Edici√≥n de Comandas

1. **Acceso**: Desde historial o lista de comandas activas
2. **Agregar Items**: Se pueden agregar productos adicionales a una comanda existente
3. **Filtrado Inteligente**: Sistema detecta autom√°ticamente qu√© items son nuevos
   - Identifica items sin ID o con ID temporal (prefijo `temp_`)
   - Verifica formato UUID para distinguir items existentes
   - Solo inserta items nuevos en base de datos
4. **Impresi√≥n Selectiva**: Solo imprime los items adicionales
   - Header especial: "** PRODUCTOS ADICIONALES **"
   - Incluye ID de comanda y referencia a mesa/cliente
   - No reimprime items existentes
5. **Sin Duplicados**: Sistema previene duplicaci√≥n de items en DB y ticket

### üí∞ Interface de Caja

1. **Selecci√≥n de Comanda**: Ver todas las comandas activas con totales
2. **Generaci√≥n de Factura**: C√°lculo autom√°tico de totales con IVA
3. **M√©todos de Pago**:
   - Efectivo (con c√°lculo autom√°tico de cambio)
   - Tarjeta
   - Transferencia
   - Mixto (efectivo + otro m√©todo)
4. **Impresi√≥n de Recibo**: Ticket de pago para el cliente
5. **Liberaci√≥n Autom√°tica**: Mesas quedan disponibles tras facturar

### üñ®Ô∏è Sistema de Impresi√≥n

El sistema utiliza un **plugin HTTP propio** que garantiza la impresi√≥n correcta de caracteres especiales del espa√±ol:

**Caracter√≠sticas del Plugin:**
- **Puerto dedicado**: 8001 (separado del backend principal)
- **Encoding**: CP850 (Code Page 850)
- **Comando ESC/POS**: `ESC t 2` (selecciona tabla de caracteres CP850)
- **Soporte completo**: √° √© √≠ √≥ √∫ √Å √â √ç √ì √ö √± √ë ¬ø ¬°
- **Sin marcas de agua** ni limitaciones de software externo
- **Transmisi√≥n binaria**: `copy /b` preserva bytes exactos
- **Auto-inicio**: Se inicia autom√°ticamente con el backend

**Tipos de Impresi√≥n:**
- **Comanda Completa**: Imprime todos los items de una comanda nueva
- **Items Adicionales**: Solo imprime items agregados en edici√≥n
- **Factura**: Ticket de pago con totales y m√©todo de pago
- **Recibo**: Copia para el cliente

**Ejemplo de Formato:**
```
=========================================
         MONTIS CLOUD
=========================================
Fecha: 21/12/2024 14:30
Comanda #123
Mesa: 5 - Sal√≥n Principal
Mesero: Juan P√©rez
-----------------------------------------
DESAYUNO
-----------------------------------------
1x Jugo Natural - Naranja      $5.00
1x Pan Franc√©s
   ‚îú‚îÄ Mermelada de fresa
   ‚îî‚îÄ Mantequilla
   Subtotal:                    $3.50
-----------------------------------------
TOTAL:                          $8.50
=========================================
```

**Para Domicilio:**
```
=========================================
         MONTIS CLOUD
      PEDIDO A DOMICILIO
=========================================
Comanda #124
Cliente: Mar√≠a Garc√≠a
Direcci√≥n: Calle Principal #123
Tel√©fono: 555-1234
-----------------------------------------
[... productos ...]
=========================================
```

## üîß Personalizaci√≥n y Administraci√≥n

### Panel de Administraci√≥n

El sistema incluye un panel completo de administraci√≥n accesible desde la interfaz principal:

**Gesti√≥n de Seguridad y Acceso:**
- **Control de Usuarios**: Crear y administrar cuentas de acceso para el personal.
- **Roles y Permisos**: Definir perfiles (Administrador, Mesero, Cajero) con permisos granulares.
- **Auditor√≠a de Acceso**: Seguimiento de √∫ltimos inicios de sesi√≥n y estados de cuenta.

**Gesti√≥n de Recursos Humanos:**
- **Expediente de Empleados**: Informaci√≥n personal, contractual y salarial centralizada.
- **Procesamiento de N√≥mina**: Liquidaci√≥n peri√≥dica con c√°lculos autom√°ticos de ley.
- **Liquidaciones Definitivas**: Gesti√≥n de retiros y pago de prestaciones sociales.

**Gesti√≥n de Productos:**
- Crear, editar y eliminar productos
- Organizar por categor√≠as
- Establecer precios
- Marcar disponibilidad

**Gesti√≥n de Mesas:**
- Configurar n√∫mero de mesas por sal√≥n
- Establecer capacidad
- Reorganizar distribuci√≥n
- Ver estado en tiempo real

**Gesti√≥n de Salones:**
- Crear m√∫ltiples salones (Terraza, Interior, VIP, etc.)
- Asignar mesas a cada sal√≥n
- Configurar capacidades

**Gesti√≥n de Personalizaciones:**
- Configurar opciones para Desayunos (jugos, panes, acompa√±amientos)
- Configurar opciones para Almuerzos (entradas, principales, postres)
- Crear categor√≠as personalizadas
- Establecer precios adicionales

**Inventario Avanzado (Insumos y Recetas):**
- **Insumos** con stock m√≠nimo/cr√≠tico y estado autom√°tico (OK/Bajo/Cr√≠tico)
- **Recetas por producto** (consumo de insumos por unidad vendida)
- **Ajustes por personalizaci√≥n** (insumos adicionales o negativos por √≠tem)
- **Historial de movimientos** (consumos y ajustes manuales)
- **Bloqueo configurable** al confirmar comandas (solo cr√≠tico / bajo+cr√≠tico / no bloquear)
- **Importaci√≥n y exportaci√≥n Excel** por entidad
- **Indicadores de riesgo** en productos y personalizaciones

### Base de Datos

**Esquema Principal:**
- `comandas`: Pedidos con soporte multi-canal (mesa/domicilio)
  - `tipo_pedido`: 'mesa' | 'domicilio'
  - `cliente_nombre`, `cliente_direccion`, `cliente_telefono`
  - `es_para_llevar`: booleano para pickup
- `comanda_items`: Productos de cada comanda
- `comanda_mesas`: Relaci√≥n muchos-a-muchos comandas-mesas
- `mesas`: Estado y configuraci√≥n de mesas
- `salones`: Organizaci√≥n de espacios
- `productos`: Cat√°logo completo
- `facturas`: Registro de pagos
- `personalizaciones_categorias` y `personalizaciones_opciones`
- **Inventario avanzado**:
  - `insumos`: cat√°logo de insumos y stock
  - `producto_insumos`: receta por producto
  - `personalizacion_insumos`: ajustes de insumos por personalizaci√≥n
  - `insumo_historial`: historial de movimientos
  - `config_sistema`: configuraci√≥n de bloqueo (`critico_modo`)

### Historial y Reportes

**Historial de Comandas:**
- Ver todas las comandas (activas y completadas)
- Filtrar por fecha, tipo, estado
- Ver detalles completos con items y totales
- Editar comandas existentes (agregar items)

**Reportes (Pr√≥ximamente):**
- Ventas por per√≠odo
- Productos m√°s vendidos
- An√°lisis por tipo de servicio
- Reporte de domicilios vs mesas

## üñ®Ô∏è Configuraci√≥n Avanzada de Impresoras

### Sistema de Impresi√≥n Propio

El sistema incluye un plugin HTTP completamente aut√≥nomo:

**Caracter√≠sticas T√©cnicas:**
- **Archivo**: `backend/modelo_imprimir_legacy/pluginImpresora.ts`
- **Puerto**: 8001 (configurable)
- **Protocolo**: HTTP POST con body en texto plano
- **Encoding**: CP850 (Code Page 850) - Est√°ndar para espa√±ol
- **Sin dependencias externas**: No requiere software de terceros

**Comandos ESC/POS Soportados:**
- `ESC @`: Reset de impresora
- `ESC t 2`: Seleccionar tabla CP850
- `ESC E 1/0`: Negrita on/off
- `ESC a 0/1/2`: Alineaci√≥n izq/centro/der
- `ESC d n`: Avanzar n l√≠neas
- `GS V 66 0`: Cortar papel

**Encodings Disponibles:**
- `cp850`: Latin 1 (espa√±ol) - **RECOMENDADO**
- `latin1`: ISO-8859-1
- `cp437`: US ASCII extendido
- `utf-8`: Unicode (requiere impresora compatible)

### Impresoras Compatibles

Cualquier impresora t√©rmica de 58mm o 80mm con soporte ESC/POS:
- Epson TM-T20, TM-T88
- Xprinter XP-58, XP-80
- Bixolon SRP-350
- Star Micronics TSP143
- POS-58 (gen√©ricas chinas)

### Configuraci√≥n Windows

1. **Conectar impresora v√≠a USB**
2. **Instalar drivers** (Windows normalmente los detecta autom√°ticamente)
3. **Identificar nombre**: Panel de Control ‚Üí Dispositivos e impresoras
4. **Configurar en .env**:
```env
PRINTER_COCINA_NAME=pos58
```

**Nota**: El nombre debe coincidir EXACTAMENTE con el que aparece en Windows.

### Soluci√≥n de Problemas de Impresi√≥n

**La impresora no imprime:**
- Verificar que est√° encendida y conectada
- Confirmar nombre en .env coincide con Windows
- Ver logs del plugin en puerto 8001: `http://localhost:8001/status`
- Probar endpoint de prueba: `POST http://localhost:8001/probar`

**Caracteres raros o basura:**
- Verificar encoding en .env (debe ser `cp850`)
- Confirmar que impresora soporta CP850 (mayor√≠a s√≠ lo hace)
- Reiniciar backend para aplicar cambios de configuraci√≥n

**No corta el papel:**
- Algunas impresoras requieren configuraci√≥n de auto-corte
- Verificar comando GS V en c√≥digo si es necesario
- Puede requerir ajuste manual del comando de corte

**Duplicados o items repetidos:**
- Ya resuelto: sistema tiene filtrado inteligente
- Solo imprime items nuevos al editar
- Verifica logs para confirmar comportamiento

## üì± Uso en Dispositivos

### Tablets (Recomendado)
- **Resoluci√≥n √≥ptima**: 1280x800 o superior
- **Sistema**: Android 8+ o iPad OS
- **Navegador**: Chrome, Safari, Edge
- **Experiencia**: Interfaz touch-friendly, botones grandes
- **Ideal para**: Meseros tomando √≥rdenes

### Celulares
- **Compatibilidad**: Dise√±o 100% responsive
- **Pantallas**: Desde 375px de ancho
- **Limitaciones**: Menos informaci√≥n visible simult√°neamente
- **Ideal para**: Consultas r√°pidas, toma de pedidos simple

### PCs / Laptops
- **Pantallas grandes**: Aprovecha espacio para mostrar m√°s datos
- **Navegaci√≥n**: Teclado y mouse optimizados
- **Ideal para**: Estaciones de caja, administraci√≥n, reportes
- **Impresi√≥n**: Conexi√≥n directa a impresoras USB

### Recomendaciones de Hardware

**Para Meseros:**
- Tablet Android 10" (ej: Samsung Tab A)
- Funda protectora con soporte
- Bater√≠a externa si jornadas largas

**Para Caja:**
- PC o Laptop Windows 10+
- Impresora t√©rmica 80mm USB
- Monitor t√°ctil opcional

**Para Cocina:**
- PC compacta o Laptop vieja
- Impresora t√©rmica 58mm o 80mm
- Soporte para colgar tickets

## üîê Seguridad y Mejores Pr√°cticas

**Implementado:**
- **Autenticaci√≥n y Autorizaci√≥n**: Sistema de sesiones seguro con hashing de contrase√±as.
- **Control de Roles (RBAC)**: Permisos granulares por m√≥dulo y rol de usuario.
- **Seguridad de Red**: Headers de seguridad con Helmet.
- **Validaci√≥n de Datos**: Validaci√≥n en todas las rutas de API.
- **Integridad de Datos**: Transacciones SQLite para procesos cr√≠ticos.
- **Sanitizaci√≥n**: Limpieza de inputs para prevenir inyecciones.

**Recomendaciones Futuras:**
- Implementar autenticaci√≥n JWT (actualmente usa sesiones en DB).
- Backup autom√°tico de base de datos en la nube.
- Configuraci√≥n de HTTPS en producci√≥n.
- Rate limiting para prevenir ataques de fuerza bruta.

## üìà Escalabilidad y Roadmap

### Estado Actual
- ‚úÖ SQLite para punto √∫nico
- ‚úÖ Soporte multi-mesa y multi-sal√≥n
- ‚úÖ Sistema multi-canal (mesa/domicilio)
- ‚úÖ Edici√≥n de comandas sin duplicados
- ‚úÖ Impresi√≥n con encoding perfecto
- ‚úÖ Gesti√≥n completa de RRHH y N√≥mina
- ‚úÖ Autenticaci√≥n y Control de Roles (RBAC)

### Pr√≥ximas Funcionalidades
- üîÑ Reportes y anal√≠ticas avanzadas
- üîÑ Integraci√≥n con delivery apps (Uber Eats, Rappi)
- üîÑ App m√≥vil nativa (React Native)
- üîÑ Sistema de inventario avanzado
- üîÑ CRM de clientes frecuentes

### Escalabilidad Multi-Punto
Para cadenas con m√∫ltiples sucursales:
1. Migrar a PostgreSQL/MySQL
2. Implementar replicaci√≥n maestro-esclavo
3. API Gateway central
4. Sincronizaci√≥n en tiempo real con WebSockets
5. Dashboard corporativo consolidado

## ü§ù Contribuir y Desarrollo

### Estructura de Branches
- `main`: Producci√≥n estable
- `develop`: Desarrollo activo
- `feature/*`: Nuevas funcionalidades
- `fix/*`: Correcciones de bugs

### Flujo de Contribuci√≥n
1. Fork el repositorio
2. Crear branch: `git checkout -b feature/nueva-funcionalidad`
3. Implementar cambios con commits descriptivos
4. Agregar tests si aplica
5. Crear Pull Request con descripci√≥n detallada

### Standards de C√≥digo
- **TypeScript**: Strict mode activado
- **ESLint**: Configuraci√≥n est√°ndar
- **Prettier**: Formateo autom√°tico
- **Commits**: Conventional Commits (feat:, fix:, docs:)

---

## üõ†Ô∏è Tecnolog√≠as Utilizadas

### Frontend
| Tecnolog√≠a | Versi√≥n | Prop√≥sito |
|------------|---------|-----------|
| **React** | 18.x | Librer√≠a de UI con hooks |
| **Next.js** | 14.x | Framework SSR con App Router |
| **TypeScript** | 5.x | Type safety en todo el c√≥digo |
| **Tailwind CSS** | 3.x | Utility-first styling |
| **Axios** | 1.x | Cliente HTTP para API calls |
| **React Context** | - | State management global |
| **date-fns** | 2.x | Manipulaci√≥n de fechas |

### Backend
| Tecnolog√≠a | Versi√≥n | Prop√≥sito |
|------------|---------|-----------|
| **Node.js** | 18+ | Runtime de JavaScript |
| **Express** | 4.x | Framework de servidor web |
| **TypeScript** | 5.x | Type safety en backend |
| **PostgreSQL** | 14+ | Base de datos relacional |
| **Kysely** | 0.27.x | Query builder type-safe |
| **JWT** | 9.x | Autenticaci√≥n con tokens |
| **bcrypt** | 5.x | Hashing de passwords |
| **Helmet** | 7.x | Headers de seguridad |
| **Compression** | 1.x | Compresi√≥n gzip de respuestas |
| **Morgan** | 1.x | Logger de requests HTTP |

### Plugin de Impresi√≥n
| Tecnolog√≠a | Versi√≥n | Prop√≥sito |
|------------|---------|-----------|
| **Python** | 3.9+ | Lenguaje del plugin |
| **Flask** | 2.x | Framework web para API |
| **pywin32** | 305+ | Interacci√≥n con impresoras Windows |
| **PyInstaller** | 5.x | Compilaci√≥n a EXE |

### Desarrollo y Herramientas
| Herramienta | Prop√≥sito |
|-------------|-----------|
| **VS Code** | Editor de c√≥digo recomendado |
| **Git** | Control de versiones |
| **pgAdmin 4** | Administraci√≥n visual de PostgreSQL |
| **Postman** | Testing de API endpoints |
| **ESLint** | Linting de c√≥digo TypeScript/JavaScript |
| **Prettier** | Formateo autom√°tico de c√≥digo |

---

## üéØ Casos de Uso Clave

### üè¢ Restaurantes de Mesa
- **Toma de pedidos** con tablets en mesas
- **Impresi√≥n autom√°tica** en cocina
- **Gesti√≥n de mesas** en tiempo real
- **Facturaci√≥n** con IVA y m√©todos de pago m√∫ltiples
- **Control de turnos** con roles de meseros y cajeros

### üçï Pizzer√≠as y Fast Food
- **Pedidos para llevar** sin necesidad de mesa
- **Domicilios** con data completa del cliente
- **Categor√≠as personalizables** (pizzas, hamburguesas, bebidas)
- **Personalizaciones** complejas (ingredientes, tama√±os, extras)
- **Impresi√≥n optimizada** para cocina (58mm)

### ‚òï Cafeter√≠as y Panader√≠as
- **Cat√°logo de productos** con im√°genes
- **Desayunos personalizables** (bebida + pan + prote√≠na)
- **Control de inventario** de insumos (caf√©, leche, panes)
- **Reportes de ventas** por producto y periodo
- **Facturaci√≥n r√°pida** para filas de clientes

### üçΩÔ∏è Cadenas Multi-Sucursal (Futuro)
- **Arquitectura escalable** con PostgreSQL
- **API centralizada** para m√∫ltiples puntos
- **Sincronizaci√≥n en tiempo real** entre sucursales
- **Dashboard corporativo** consolidado
- **Replicaci√≥n maestro-esclavo** para alta disponibilidad

---

## üìà Roadmap Futuro

### üîú Corto Plazo (Q1-Q2 2025)
- [ ] **Dashboard de Anal√≠ticas**: Gr√°ficos de ventas, productos estrella, tendencias
- [ ] **App M√≥vil Nativa**: React Native para Android/iOS
- [ ] **Modo Offline**: Sincronizaci√≥n cuando se recupere conexi√≥n
- [ ] **Sistema de Propinas**: Tracking y distribuci√≥n entre meseros
- [ ] **Reservas Online**: Widget para p√°gina web del restaurante

### üìÖ Mediano Plazo (Q3-Q4 2025)
- [ ] **CRM de Clientes**: Base de datos de clientes frecuentes con historial
- [ ] **Programa de Fidelizaci√≥n**: Puntos y descuentos por compras
- [ ] **Integraci√≥n Delivery Apps**: Uber Eats, Rappi, DiDi Food
- [ ] **Pasarelas de Pago**: Mercado Pago, PayU, Stripe
- [ ] **WhatsApp Business**: Pedidos v√≠a chat automatizado

### üöÄ Largo Plazo (2026+)
- [ ] **Machine Learning**: Predicci√≥n de demanda y sugerencias inteligentes
- [ ] **Multi-Tenant SaaS**: Una instancia para m√∫ltiples restaurantes
- [ ] **API P√∫blica**: Para integraciones de terceros
- [ ] **Men√∫ Digital con QR**: Clientes piden desde su celular
- [ ] **Sistema de Delivery Propio**: Con tracking GPS de domiciliarios

---

## üåü Ventajas Competitivas

### ‚úÖ Comparado con Soluciones Comerciales

| Caracter√≠stica | Este Sistema | Rappi POS | Square POS | Toast POS |
|----------------|--------------|-----------|------------|-----------|
| **Costo Mensual** | $0 (auto-hospedado) | $50-200/mes | $60/mes | $165/mes |
| **Hardware Propio** | ‚úÖ Usa cualquier PC/Tablet | ‚ùå Hardware propietario | ‚ö†Ô∏è Hardware recomendado | ‚ùå Hardware propietario |
| **Sin Comisiones** | ‚úÖ 0% | ‚ùå 3-5% por transacci√≥n | ‚ùå 2.9% + 30¬¢ | ‚ùå 2.99% |
| **C√≥digo Abierto** | ‚úÖ Personalizable | ‚ùå Cerrado | ‚ùå Cerrado | ‚ùå Cerrado |
| **Impresi√≥n Sin Marca** | ‚úÖ Sin watermarks | ‚ö†Ô∏è Con logo empresa | ‚ö†Ô∏è Con logo empresa | ‚ö†Ô∏è Con logo empresa |
| **Inventario Avanzado** | ‚úÖ Con recetas e insumos | ‚ö†Ô∏è B√°sico | ‚ö†Ô∏è B√°sico | ‚úÖ Avanzado |
| **RRHH Integrado** | ‚úÖ N√≥mina y liquidaciones | ‚ùå No incluido | ‚ùå No incluido | ‚ö†Ô∏è Addon pago |
| **Multi-Canal** | ‚úÖ Mesa/Delivery/Llevar | ‚úÖ S√≠ | ‚úÖ S√≠ | ‚úÖ S√≠ |
| **Roles y Permisos** | ‚úÖ 23 m√≥dulos granulares | ‚ö†Ô∏è B√°sico | ‚ö†Ô∏è B√°sico | ‚úÖ Avanzado |
| **Soporte 24/7** | ‚ö†Ô∏è Documentaci√≥n | ‚úÖ S√≠ | ‚úÖ S√≠ | ‚úÖ S√≠ |

### üéÅ Beneficios Clave

1. **üí∞ Sin Costos Recurrentes**: Auto-hospedado, sin mensualidades ni comisiones
2. **üîì Control Total**: Acceso completo al c√≥digo fuente para personalizaciones
3. **üì¶ Todo en Uno**: Comandas + Inventario + RRHH + Facturaci√≥n en una sola plataforma
4. **üñ®Ô∏è Impresi√≥n Profesional**: Plugin propio sin dependencias de terceros
5. **üîí Seguridad**: Datos en tu propio servidor, no en la nube de terceros
6. **‚ö° Performance**: Optimizado para velocidad y bajo consumo de recursos
7. **üì± Multi-Dispositivo**: Funciona en tablets, celulares, PCs sin apps nativas
8. **üá®üá¥ Adaptado a Colombia**: C√°lculos de n√≥mina seg√∫n ley colombiana

---

## üìÑ Licencia y Soporte

**Licencia**: Proyecto propietario de **Montis Cloud**.

**Desarrollado por**: Juan Monta√±ez (@jmont)

**Versi√≥n Actual**: 2.0.0 (Enero 2025)

**Soporte T√©cnico:**
- üìñ **Documentaci√≥n completa** en este README
- üìÇ **Gu√≠as adicionales** en carpeta `/GUIA DE USO/`
- üêõ **Logs detallados** en consola del backend para debugging
- üè• **Health check**: `http://localhost:3001/health`
- üìß **Contacto**: Para consultas o soporte, contactar al desarrollador

**Estado del Proyecto**: ‚úÖ **Producci√≥n Estable** - Actualmente en uso en Casa Montis Restaurante

---

## üôè Agradecimientos

Este sistema fue desarrollado como soluci√≥n integral para la gesti√≥n operativa de **Casa Montis Restaurante**, integrando:
- Toma de comandas multi-canal (mesa, domicilio, para llevar)
- Sistema de inventario inteligente con recetas e insumos
- M√≥dulo completo de recursos humanos con n√≥mina y liquidaciones
- Impresi√≥n t√©rmica con encoding perfecto para espa√±ol
- Control de acceso con roles y permisos granulares

Agradecimientos especiales a:
- **Casa Montis** por confiar en la visi√≥n del proyecto
- **Comunidad Open Source** por las librer√≠as y herramientas utilizadas
- **Claude/Anthropic** por asistencia en desarrollo y documentaci√≥n

---

## üìù Changelog Reciente

### Versi√≥n 2.0.0 (Enero 2025) - "Enterprise Ready"

**üÜï Nuevas Caracter√≠sticas:**
- ‚ú® **Configuraci√≥n de Impresoras**: Selector de ancho de papel (58mm/80mm) y tama√±o de fuente (Small/Normal/Large)
- üí∞ **V.UNIT en Facturas**: Columna de Valor Unitario agregada a facturas y recibos
- üîê **Sistema de Roles Completo**: RBAC con 23 m√≥dulos y permisos granulares
- üë• **M√≥dulo de RRHH**: N√≥mina, liquidaciones, contratos y expedientes
- üì¶ **Inventario Avanzado**: Insumos, recetas, ajustes autom√°ticos, indicadores de riesgo
- üóÑÔ∏è **Migraci√≥n a PostgreSQL**: De SQLite a PostgreSQL para escalabilidad
- üìä **Preview din√°mico**: Vista previa de recibos con configuraci√≥n en tiempo real

**üêõ Correcciones:**
- ‚úÖ Overflow de descripciones de productos en tablas (GestionProductos y SeleccionProductos)
- ‚úÖ Separadores que se desbordaban con fuente grande (ajuste de caracteres efectivos)
- ‚úÖ Impresi√≥n selectiva de items adicionales (sin duplicados)
- ‚úÖ Marcado autom√°tico de `is_impreso` en items de comanda

**üîß Mejoras:**
- ‚ö° Optimizaci√≥n de consultas con PostgreSQL y Kysely
- üé® UI/UX mejorada en panel de administraci√≥n
- üì± Responsiveness perfeccionado para todos los dispositivos
- üîí Seguridad endurecida con middleware y validaciones
- üìù Documentaci√≥n completa actualizada (este README)

### Versi√≥n 1.5.0 (Diciembre 2024) - "Multi-Canal"
- ‚úÖ Soporte para pedidos a domicilio y para llevar
- ‚úÖ Formulario de datos de cliente
- ‚úÖ Impresi√≥n diferenciada seg√∫n tipo de pedido
- ‚úÖ Edici√≥n de comandas con agregado de items

### Versi√≥n 1.0.0 (Noviembre 2024) - "MVP"
- ‚úÖ Sistema de comandas para mesas
- ‚úÖ Cat√°logo de productos con categor√≠as
- ‚úÖ Impresi√≥n t√©rmica b√°sica
- ‚úÖ Facturaci√≥n con IVA

---

## üéâ Conclusi√≥n

**Sistema de Comandas Casa Montis** es una soluci√≥n integral, moderna y escalable para la gesti√≥n operativa de restaurantes. Construido con tecnolog√≠as de √∫ltima generaci√≥n y arquitectura modular, ofrece todas las funcionalidades necesarias para:

‚úÖ **Operaciones Diarias**: Toma de pedidos, facturaci√≥n, gesti√≥n de mesas  
‚úÖ **Control Administrativo**: Inventario, RRHH, roles y permisos  
‚úÖ **Impresi√≥n Profesional**: Sistema propio sin dependencias externas  
‚úÖ **Escalabilidad**: Preparado para crecer de un punto a m√∫ltiples sucursales  

**¬øPor qu√© elegir este sistema?**
- üí∏ **Sin costos recurrentes** vs $50-200/mes de competidores
- üîì **Control total** del c√≥digo y los datos
- üá®üá¥ **Adaptado a Colombia** (n√≥mina seg√∫n ley colombiana)
- ‚ö° **Performance** optimizado y lightweight
- üìà **Activamente desarrollado** con roadmap claro

**Estado Actual**: ‚úÖ **Producci√≥n Estable** - Sistema completo y funcional usado diariamente en Casa Montis Restaurante.

---

<div align="center">

**‚≠ê Si este proyecto te resulta √∫til, considera dejarnos una estrella en GitHub**

**Desarrollado con ‚ù§Ô∏è por Juan Monta√±ez para Casa Montis**

**¬© 2025 Montis Cloud. Todos los derechos reservados.**

</div>

